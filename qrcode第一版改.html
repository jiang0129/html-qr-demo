<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code æƒæå™¨</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        background: #f0f0f0;
      }
      h1 {
        margin-bottom: 10px;
        text-align: center;
      }
      #reader {
        width: 320px;
        height: 320px;
        border-radius: 10px;
        overflow: hidden;
        background-color: #000;
        margin-bottom: 20px;
      }
      #result {
        font-size: 18px;
        color: #333;
        min-height: 40px;
        text-align: center;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” QR Code æƒæå™¨</h1>
    <div id="reader"></div>
    <div id="result">ç­‰å¾…æƒæ...</div>

    <script>
      let html5QrCode = null;

      async function startScanning() {
        if (html5QrCode) return;

        try {
          const cameras = await Html5Qrcode.getCameras();
          if (!cameras || cameras.length === 0) {
            alert("æœªåµæ¸¬åˆ°æ”å½±æ©Ÿï¼Œè«‹æª¢æŸ¥è¨­å‚™æ¬Šé™");
            return;
          }

          // å„ªå…ˆå¾Œé¡é ­
          let rearCam = cameras.find(cam => 
            cam.label.toLowerCase().includes('back') ||
            cam.label.toLowerCase().includes('rear') ||
            cam.label.toLowerCase().includes('environment')
          );
          let cameraConfig = rearCam 
            ? { facingMode: { exact: "environment" } } 
            : { facingMode: "environment" };

          html5QrCode = new Html5Qrcode("reader");

          const qrConfig = {
            fps: 15,                     // æ¯ç§’å¹€æ•¸
            qrbox: { width: 250, height: 250 },
            disableFlip: false
          };

          await html5QrCode.start(
            cameraConfig,
            qrConfig,
            (decodedText) => {
              document.getElementById('result').textContent = `æƒæåˆ°: ${decodedText}`;
            },
            (error) => {
              // éœé»˜å¤±æ•—ï¼Œä¸é¡¯ç¤º
            }
          );
        } catch (err) {
          console.error("æƒæå•Ÿå‹•å¤±æ•—:", err);
          alert("æƒæå•Ÿå‹•å¤±æ•—: " + err);
        }
      }

      // å•Ÿå‹•æƒæ
      startScanning();

      // å¸è¼‰é é¢æ™‚é‡‹æ”¾æ”å½±æ©Ÿ
      window.addEventListener('beforeunload', async () => {
        if (html5QrCode) {
          try { await html5QrCode.stop(); } catch(e) {}
        }
      });
    </script>
  </body>
</html>