<html>
        <head>
            <title>Html-Qrcode Demo ä¿®æ­£ç‰ˆ</title>
        </head>
        <body>
            <h1>Html-Qrcode Demoï¼ˆç©©å®šç‰ˆæœ¬ï¼‰</h1>
            <div id="qr-reader" style="width:500px"></div>
            <div id="qr-reader-results"></div>

            <script src="https://unpkg.com/html5-qrcode"></script>
            <script>
                function docReady(fn) {
                    if (document.readyState === "complete" ||
                        document.readyState === "interactive") {
                        setTimeout(fn, 1);
                    } else {
                        document.addEventListener("DOMContentLoaded", fn);
                    }
                }

                docReady(async function () {
                    const resultContainer = document.getElementById('qr-reader-results');
                    let lastResult = "";
                    let countResults = 0;

                    // ğŸ”¥ å¼·åŒ–ç‰ˆ: æ–°å¢ onScanFailure â†’ ä¿æŒæƒæå¾ªç’°ä¸æœƒå¡
                    function onScanFailure(error) {
                        // éœé»˜è·³éï¼Œä¸è¦é¡¯ç¤º
                        // console.log("æƒæå¤±æ•—ï¼ˆå¿½ç•¥ï¼‰", error);
                    }

                    // ğŸ”¥ æƒææˆåŠŸ
                    function onScanSuccess(decodedText, decodedResult) {
                        if (decodedText !== lastResult) {
                            countResults++;
                            lastResult = decodedText;
                            resultContainer.innerHTML = "æƒæåˆ°çš„å…§å®¹ï¼š" + decodedText;
                        }
                    }

                    // ğŸ”¥ å¼·åˆ¶é¸ç”¨å¾Œé¡é ­ï¼ˆenvironmentï¼‰
                    let config = { facingMode: "environment" };

                    // ä¿®æ­£ï¼šæŠŠ Html5QrcodeScanner çš„è¨­å®šèª¿æ•´åˆ°æœ€ä½³
                    const enhancedConfig = {
                        fps: 15,
                        qrbox: { width: 250, height: 250 }, // é¿å…åŸæœ¬çš„ 400 å¤ªå¤§
                        disableFlip: false, // ä¿ç•™è‡ªå‹•ç¿»è½‰
                        rememberLastUsedCamera: true
                    };

                    // å»ºç«‹ scanner
                    const scanner = new Html5QrcodeScanner(
                        "qr-reader",
                        enhancedConfig
                    );

                    // ğŸ‘‰ é‡è¦ï¼šä½¿ç”¨ render ä½†è£œä¸Š onScanFailure
                    // Html5QrcodeScanner åŸç‰ˆä¸æ”¯æ´ onScanFailureï¼Œæ‰€ä»¥æˆ‘å€‘ patch å®ƒ
                    const oldRender = scanner.render.bind(scanner);

                    scanner.render = function(patchedSuccessCallback) {
                        // ç”¨ patch æ–¹å¼åŠ å…¥ failure callback
                        return oldRender(
                            patchedSuccessCallback,
                            onScanFailure      // ğŸ”¥ åŠ ä¸Š onScanFailure â†’ æŒçºŒæƒæ
                        );
                    };

                    // å•Ÿå‹•
                    scanner.render(onScanSuccess);
                });
            </script>
        </body>
    </html>